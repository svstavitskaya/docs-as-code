# Заголовок - Sequence Diagram 

# Рассылка e-mail писем

* код
* рисунок диаграммы
  
```mermaid

sequenceDiagram
actor Пользователь
participant Система
participant БД
participant Майло.пост_API

Пользователь -> Система : Нажимает на кнопку\n"Создать рассылку"
Система-->>Пользователь : Отображает форму рассылки
Пользователь -> Система : Нажимает на кнопку\n"Сохранить ченовик"
Система -> БД : Сохраняет созданную рассылку в БД
Система -> Майло.пост_API : POST https://api.mailopost.ru/v1/email/campaigns

alt Успеный кейс 
loop#00ffa1 Ответ 200
Майло.пост_API-->>Система  : Ответ "200" application/json
Система ->  БД : Обновляет статус рассылки: draft
Система -> Майло.пост_API :POST https://api.mailopost.ru/v1/email/messages_webhooks\nОтслеживание статуса рассылки
end
else Вид ошибки после отправки черновика
    loop#ff005e Ошибка 400
    Майло.пост_API -->>Система : Request 400 Неверные параметры\napplication/json
    Система -> Система : Запись Log-ов
    Система-->>Пользователь : Отправка сообщения об ошибке
    end
    loop#ff005e Ошибка 402
    Майло.пост_API-->>Система : Недостаточно средств\napplication/json;
    Система -> Система : Запись Log-ов
    Система -->>Пользователь : Сообщение о необходимости пополнить баланс счёта
    end
    loop#ff005e Ошибка 404
    Майло.пост_API-->>Система : Ресурс не найден\napplication/json
    Система -> Система : Запись Log-ов
    Система-->>Пользователь : Сообщение об ошибке
    end
    loop#ff005e Ошибка 415
    Майло.пост_API-->>Система : Неподдерживаемый тип данных\napplication/json
    Система -> Система : Запись Log-ов
    Система-->>Пользователь : Сообщение об ошибке
    end
    loop#ff005e Ошибка 500
    Майло.пост_API-->>Система : Неизвестная ошибка\napplication/json
    Система -> Система : Запись Log-ов
    Система-->>Пользователь : Сообщение об ошибке
    end
end
     alt#00ffa1 Ответ 200
    loop
        Майло.пост_API-->>Система  : Ответ "200" application/json
        Система -> БД : Обновить данные по статусу и рассылке
        Майло.пост_API-->>Система : application/json со статусами completed по рассылке
        Система-->>Пользователь : Уведомление в ЛК об успешном завершении рассылки
      end
        else Вид ошибки
        loop#ff005e Ошибка 400
        Майло.пост_API-->>Система : Request 400 Неверные параметры\napplication/json
        Система -> Система : Запись Log-ов
        Система -->>Пользователь : Отправка сообщения об ошибке
        end
        loop#ff005e Ошибка 422
        Майло.пост_API-->>Система : Request 422 Ресурс не может быть обработан\napplication/json
        Система -> Система : Запись Log-ов
        Система -->>Пользователь : Отправка сообщения об ошибке
        end
        loop#ff005e Ошибка 500
        Майло.пост_API-->>Система : Request 500 Неизвестная ошибка\napplication/json
        Система -> Система : Запись Log-ов
        Система -->>Пользователь : Отправка сообщения об ошибке
        end
end

```
